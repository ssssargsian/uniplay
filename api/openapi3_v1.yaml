---
openapi: 3.0.3
info:
  title: Uniplay private API
  version: 1.0.0
servers:
- url: http://localhost:8080/v1
tags:
- name: player
  description: Профиль игрока
- name: replay
  description: Запись матча
paths:
  /players/{steam_id}:
    get:
      tags:
      - player
      summary: Получения профиля игрока
      operationId: getPlayerProfile
      parameters:
      - name: steam_id
        in: path
        description: uint64
        required: true
        style: simple
        explode: false
        schema:
          type: integer
          format: uint64
          x-go-type: uint64
          x-go-name: SteamID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayerProfile'
        "404":
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /players/{steam_id}/matches:
    post:
      tags:
      - player
      summary: Получение списка матчей игрока
      operationId: getPlayerMatches
      parameters:
      - name: steam_id
        in: path
        description: uint64
        required: true
        style: simple
        explode: false
        schema:
          type: integer
          format: uint64
          x-go-type: uint64
          x-go-name: SteamID
      requestBody:
        $ref: '#/components/requestBodies/PlayerMatchListRequestBody'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MatchList'
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /replays:
    post:
      tags:
      - replay
      summary: Загрузить запись матча
      operationId: uploadReplay
      requestBody:
        $ref: '#/components/requestBodies/ReplayUploadRequestBody'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Match'
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "409":
          description: Conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
components:
  schemas:
    Error:
      required:
      - code
      - message
      type: object
      properties:
        code:
          type: integer
          description: статус ответа или код ошибки >= 600
          format: uint16
          x-go-type: uint16
        message:
          type: string
          description: сообщение ошибки
    PlayerProfile:
      required:
      - create_time
      - main_team_name
      - stats
      - steam_id
      - update_time
      - weapon_class_stats
      - weapon_stats
      type: object
      properties:
        steam_id:
          type: integer
          format: uint64
          x-go-name: SteamID
          x-go-type: uint64
        main_team_name:
          type: string
        stats:
          $ref: '#/components/schemas/PlayerStats'
        weapon_stats:
          $ref: '#/components/schemas/WeaponStats'
        weapon_class_stats:
          $ref: '#/components/schemas/WeaponClassStats'
        create_time:
          type: string
          description: RFC3339 datetime string
          format: date-time
          x-go-type: time.Time
        update_time:
          type: string
          description: RFC3339 datetime string
          format: date-time
          x-go-type: time.Time
    PlayerStats:
      required:
      - assists_per_round
      - blind_per_round
      - blinded_per_round
      - damage_per_round
      - deaths_per_round
      - grenade_damage_per_round
      - headshot_percentage
      - kill_death_ratio
      - kills_per_round
      - matches_played
      - rounds_played
      - total_deaths
      - total_kills
      type: object
      properties:
        total_kills:
          type: integer
          format: uint32
          x-go-type: uint32
        total_deaths:
          type: integer
          format: uint32
          x-go-type: uint32
        kill_death_ratio:
          type: number
          format: double
          x-go-type: float64
        damage_per_round:
          type: number
          format: double
          x-go-type: float64
        grenade_damage_per_round:
          type: number
          format: double
          x-go-type: float64
        kills_per_round:
          type: number
          format: double
          x-go-type: float64
        assists_per_round:
          type: number
          format: double
          x-go-type: float64
        deaths_per_round:
          type: number
          format: double
          x-go-type: float64
        blind_per_round:
          type: number
          format: double
          x-go-type: float64
        blinded_per_round:
          type: number
          format: double
          x-go-type: float64
        headshot_percentage:
          type: number
          format: double
          x-go-type: float64
        matches_played:
          type: integer
          format: uint16
          x-go-type: uint16
        rounds_played:
          type: integer
          format: uint32
          x-go-type: uint32
    WeaponStat:
      required:
      - total_kills
      - weapon_name
      type: object
      properties:
        weapon_name:
          type: string
        total_kills:
          type: integer
          format: uint32
          x-go-type: uint32
    WeaponClassStat:
      required:
      - total_kills
      - weapon_class
      type: object
      properties:
        weapon_class:
          type: string
        total_kills:
          type: integer
          format: uint32
          x-go-type: uint32
    WeaponStats:
      type: array
      items:
        $ref: '#/components/schemas/WeaponStat'
    WeaponClassStats:
      type: array
      items:
        $ref: '#/components/schemas/WeaponClassStat'
    MatchTeam:
      required:
      - clan_name
      - flag_code
      - player_steam_ids
      - score
      type: object
      properties:
        clan_name:
          type: string
          description: название команды, берется из загруженной записи матча
        flag_code:
          type: string
          description: ISO 3166 код флага
        score:
          type: integer
          format: uint8
          x-go-type: uint8
        player_steam_ids:
          type: array
          items:
            type: integer
            format: uint64
            x-go-type: uint64
    Match:
      required:
      - map_name
      - match_duration
      - match_id
      - team1
      - team2
      - upload_time
      type: object
      properties:
        match_id:
          type: string
          format: uuid
          x-go-name: MatchID
          x-go-type: google_uuid.UUID
          x-go-type-import:
            name: google_uuid
            path: github.com/google/uuid
        map_name:
          type: string
        match_duration:
          type: integer
          format: int64
          x-go-type: time.Duration
        team1:
          $ref: '#/components/schemas/MatchTeam'
        team2:
          $ref: '#/components/schemas/MatchTeam'
        upload_time:
          type: string
          description: datetime RFC3339
          format: date-time
          x-go-type: time.Time
    MatchList:
      required:
      - matches
      - next_page_token
      type: object
      properties:
        matches:
          type: array
          items:
            $ref: '#/components/schemas/Match'
        next_page_token:
          type: string
          example: U3dhZ2dlciByb2Nrcw==
    SortOrder:
      type: string
      enum:
      - ASC
      - DESC
    PlayerMatchListSort:
      required:
      - upload_time
      type: object
      properties:
        upload_time:
          $ref: '#/components/schemas/SortOrder'
    PlayerMatchListRequest:
      required:
      - page_size
      - page_token
      - sort
      type: object
      properties:
        sort:
          $ref: '#/components/schemas/PlayerMatchListSort'
        page_size:
          type: integer
          format: uint16
          x-go-type: uint16
        page_token:
          type: string
          description: base64 string
          example: U3dhZ2dlciByb2Nrcw==
  requestBodies:
    ReplayUploadRequestBody:
      content:
        multipart/form-data:
          schema:
            type: object
            properties:
              replay:
                type: string
                description: запись матча в формате .dem, макс. размер 300 мб
                format: binary
      required: true
    PlayerMatchListRequestBody:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/PlayerMatchListRequest'
      required: true
